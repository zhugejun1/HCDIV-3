<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Changi Area Property Analysis</title>  
    <!-- 引入D3.js -->  
    <script src="https://d3js.org/d3.v7.min.js"></script>  
    <!-- 引入Tailwind CSS -->  
    <script src="https://cdn.tailwindcss.com"></script>  
    <style>  
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');  
        body {  
            font-family: 'Poppins', sans-serif;  
            background: linear-gradient(135deg, #f6f8fc 0%, #f0f4f8 100%);  
        }  
        .tooltip {  
            position: absolute;  
            background: rgba(0, 0, 0, 0.8);  
            color: white;  
            padding: 8px 12px;  
            border-radius: 6px;  
            pointer-events: none;  
            display: none;  
            z-index: 1000;  
            font-size: 14px;  
            text-align: left;  
        }  
        .stat-card {  
            background: white;  
            border-radius: 12px;  
            padding: 1.5rem;  
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);  
            transition: transform 0.2s ease;  
        }  
        .stat-card:hover {  
            transform: translateY(-2px);  
        }  
        .chart-container {  
            background: white;  
            border-radius: 16px;  
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);  
            position: relative;  
            overflow: hidden;  
            padding: 1.5rem;  
            margin-top: 2rem;  
        }  
        .axis text {  
            font-size: 12px;  
            font-weight: 500;  
        }  
        .axis path, .axis line {  
            stroke: #cbd5e1;  
        }  
        .grid line {  
            stroke: #e2e8f0;  
            stroke-dasharray: 2,2;  
        }  
        .bar {  
            transition: all 0.3s ease;  
        }  
        .bar:hover {  
            filter: brightness(1.1);  
        }  
        .legend rect {  
            width: 15px;  
            height: 15px;  
        }  
        .legend text {  
            font-size: 12px;  
        }  
    </style>  
</head>  
<body class="min-h-screen py-12">  
    <div class="container mx-auto px-4">  
        <!-- Header Section -->  
        <div class="max-w-4xl mx-auto mb-12 text-center">  
            <div class="p-4 bg-white shadow-md rounded-md border-l-4 border-blue-500">  
                <p class="text-xs tracking-wider text-gray-500 uppercase">Created by</p>  
                <h2 class="text-2xl font-semibold text-gray-800">ZHUGEJUN</h2>  
                <p class="text-base text-gray-600">Student ID: <span class="font-semibold">1009699</span></p>  
            </div>  
        </div>  

        <!-- Summary Section -->  
        <div class="max-w-4xl mx-auto text-center mb-8">  
            <h1 class="text-5xl font-bold text-gray-800 mb-2">Changi Property Insights</h1>  
            <p class="text-gray-600 text-lg">Tracking resale trends in properties located in Singapore's eastern region</p>  
        </div>  

        <!-- Main Content Starts Here -->  
        <div class="max-w-4xl mx-auto">  
            <!-- Statistics Cards -->  
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">  
                <div class="stat-card">  
                    <div class="text-sm text-gray-500 mb-1">Average Price (2023)</div>  
                    <div class="text-2xl font-bold text-gray-800" id="avgPrice">Loading...</div>  
                </div>  
                <div class="stat-card">  
                    <div class="text-sm text-gray-500 mb-1">Price Growth</div>  
                    <div class="text-2xl font-bold text-gray-800" id="priceGrowth">Loading...</div>  
                </div>  
                <div class="stat-card">  
                    <div class="text-sm text-gray-500 mb-1">Price Gap</div>  
                    <div class="text-2xl font-bold text-gray-800" id="priceGap">Loading...</div>  
                </div>  
            </div>  

            <!-- Chart Container -->  
            <div class="chart-container">  
                <div id="chart" class="w-full h-[400px]"></div>  
                <div id="tooltip" class="tooltip"></div>  
            </div>  
        </div>  
    </div>  

    <script>  
        document.addEventListener('DOMContentLoaded', function() {  
            const formatCurrency = new Intl.NumberFormat('en-SG', {  
                style: 'currency',  
                currency: 'SGD',  
                minimumFractionDigits: 0  
            });  

            const data = [  
                { year: 2017, "CHANGI ROAD": 450000, "UPPER CHANGI ROAD": 480000 },  
                { year: 2018, "CHANGI ROAD": 470000, "UPPER CHANGI ROAD": 495000 },  
                { year: 2019, "CHANGI ROAD": 485000, "UPPER CHANGI ROAD": 510000 },  
                { year: 2020, "CHANGI ROAD": 495000, "UPPER CHANGI ROAD": 525000 },  
                { year: 2021, "CHANGI ROAD": 520000, "UPPER CHANGI ROAD": 550000 },  
                { year: 2022, "CHANGI ROAD": 550000, "UPPER CHANGI ROAD": 580000 },  
                { year: 2023, "CHANGI ROAD": 580000, "UPPER CHANGI ROAD": 610000 }  
            ];  

            function updateStats() {  
                const latestYear = data[data.length - 1];  
                const firstYear = data[0];  
                const avgPrice = (latestYear["CHANGI ROAD"] + latestYear["UPPER CHANGI ROAD"]) / 2;  
                document.getElementById("avgPrice").textContent = formatCurrency.format(avgPrice);  
                const avgGrowth = (((latestYear["CHANGI ROAD"] / firstYear["CHANGI ROAD"]) + (latestYear["UPPER CHANGI ROAD"] / firstYear["UPPER CHANGI ROAD"])) / 2 - 1) * 100;  
                document.getElementById("priceGrowth").textContent = `+${avgGrowth.toFixed(1)}%`;  
                const gap = latestYear["UPPER CHANGI ROAD"] - latestYear["CHANGI ROAD"];  
                document.getElementById("priceGap").textContent = formatCurrency.format(gap);  
            }  

            function createChart() {  
                // 清除现有的图表  
                d3.select("#chart").selectAll("*").remove();  

                // 设置图表尺寸  
                const margin = {top: 60, right: 30, bottom: 60, left: 80};  
                const container = document.getElementById('chart');  
                const width = container.clientWidth - margin.left - margin.right;  
                const height = container.clientHeight - margin.top - margin.bottom;  

                // 创建SVG  
                const svg = d3.select("#chart")  
                    .append("svg")  
                    .attr("width", width + margin.left + margin.right)  
                    .attr("height", height + margin.top + margin.bottom)  
                    .append("g")  
                    .attr("transform", `translate(${margin.left},${margin.top})`);  

                // 设置比例尺  
                const x0 = d3.scaleBand()  
                    .domain(data.map(d => d.year))  
                    .range([0, width])  
                    .padding(0.2);  

                const x1 = d3.scaleBand()  
                    .domain(["CHANGI ROAD", "UPPER CHANGI ROAD"])  
                    .range([0, x0.bandwidth()])  
                    .padding(0.05);  

                const y = d3.scaleLinear()  
                    .domain([0, d3.max(data, d => Math.max(d["CHANGI ROAD"], d["UPPER CHANGI ROAD"])) * 1.1])  
                    .range([height, 0])  
                    .nice();  

                // 添加X轴  
                svg.append("g")  
                    .attr("transform", `translate(0,${height})`)  
                    .call(d3.axisBottom(x0));  

                // 添加Y轴  
                svg.append("g")  
                    .call(d3.axisLeft(y)  
                        .tickFormat(d => formatCurrency.format(d)));  

                // 定义颜色  
                const colors = {  
                    "CHANGI ROAD": "#3b82f6",  
                    "UPPER CHANGI ROAD": "#ef4444"  
                };  

                // 创建柱状图组  
                const groups = svg.selectAll("g.year")  
                    .data(data)  
                    .enter()  
                    .append("g")  
                    .attr("class", "year")  
                    .attr("transform", d => `translate(${x0(d.year)},0)`);  

                // 添加柱子  
                ["CHANGI ROAD", "UPPER CHANGI ROAD"].forEach(key => {  
                    groups.append("rect")  
                        .attr("x", d => x1(key))  
                        .attr("y", d => y(d[key]))  
                        .attr("width", x1.bandwidth())  
                        .attr("height", d => height - y(d[key]))  
                        .attr("fill", colors[key])  
                        .attr("class", "bar")  
                        .on("mouseover", function(event, d) {  
                            const tooltip = d3.select("#tooltip");  
                            tooltip.style("display", "block")  
                                   .html(`  
                                    <div class="font-semibold">${key}</div>  
                                    <div>${formatCurrency.format(d[key])}</div>  
                                    <div class="text-xs opacity-75">Year: ${d.year}</div>  
                                   `);  
                            d3.select(this)  
                                .attr("opacity", 0.8)  
                                .attr("stroke", "#fff")  
                                .attr("stroke-width", 2);  
                        })  
                        .on("mousemove", function(event) {  
                            const tooltip = d3.select("#tooltip");  
                            tooltip.style("left", `${event.pageX}px`)  
                                   .style("top", `${event.pageY}px`);  
                        })  
                        .on("mouseout", function() {  
                            const tooltip = d3.select("#tooltip").style("display", "none");  
                            d3.select(this)  
                                .attr("opacity", 1)  
                                .attr("stroke", "none");  
                        });  
                });  

                // 添加图例  
                const legend = svg.append("g")  
                    .attr("class", "legend")  
                    .attr("transform", `translate(-60, ${-40})`);  

                ["CHANGI ROAD", "UPPER CHANGI ROAD"].forEach((key, i) => {  
                    const legendGroup = legend.append("g")  
                        .attr("transform", `translate(${i * 120}, 0)`);  

                    legendGroup.append("rect")  
                        .attr("width", 15)  
                        .attr("height", 15)  
                        .attr("fill", colors[key]);  

                    legendGroup.append("text")  
                        .attr("x", 20)  
                        .attr("y", 12)  
                        .style("font-size", "12px")  
                        .text(key.split(" ")[0]);  
                });  
            }  

            // 初始化  
            updateStats();  
            createChart();  

            // 监听窗口大小变化，重新绘制图表  
            window.addEventListener('resize', createChart);  
        });  
    </script>  
</body>  
</html>
