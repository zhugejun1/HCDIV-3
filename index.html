<!DOCTYPE html>  
    <html lang="en">  
    <head>  
        <meta charset="UTF-8">  
        <meta name="viewport" content="width=device-width, initial-scale=1.0">  
        <title>Changi Area Property Analysis</title>  
        <script src="https://d3js.org/d3.v7.min.js"></script>  
        <script src="https://cdn.tailwindcss.com"></script>  
        <style>  
            @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');  
            body {  
                font-family: 'Poppins', sans-serif;  
                background: linear-gradient(135deg, #f6f8fc 0%, #f0f4f8 100%);  
            }  
            .axis text {  
                font-size: 12px;  
                font-weight: 500;  
            }  
            .axis path,  
            .axis line {  
                stroke: #cbd5e1;  
            }  
            .grid line {  
                stroke: #e2e8f0;  
                stroke-dasharray: 2, 2;  
            }  
            .tooltip {  
                position: absolute;  
                background: rgba(17, 24, 39, 0.85); /* 半透明背景 */  
                color: white;  
                padding: 0.8rem 1rem;  
                border-radius: 8px;  
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);  
                pointer-events: none;  
                display: none;  
                backdrop-filter: blur(4px);  
                border: 1px solid rgba(255, 255, 255, 0.1);  
                z-index: 10; /* 确保在柱状图之上 */  
            }  
            .chart-container {  
                background: white;  
                border-radius: 16px;  
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);  
                position: relative;  
                overflow: hidden;  
            }  
        </style>  
    </head>  
    <body class="min-h-screen py-12">  
        <div class="container mx-auto px-4">  
            <div class="max-w-6xl mx-auto">  
                <h1 class="text-4xl font-bold text-gray-800 mb-4 text-center">Changi Property Insights</h1>  
                <div id="tooltip" class="tooltip"></div>  
                <div class="chart-container p-6">  
                    <div id="chart" class="w-full"></div>  
                </div>  
            </div>  
        </div>  
        <script>  
            const formatCurrency = new Intl.NumberFormat('en-SG', {  
                style: 'currency',  
                currency: 'SGD',  
                minimumFractionDigits: 0  
            });  

            const data = [  
                { year: 2017, "CHANGI ROAD": 450000, "UPPER CHANGI ROAD": 480000 },  
                { year: 2018, "CHANGI ROAD": 470000, "UPPER CHANGI ROAD": 495000 },  
                { year: 2019, "CHANGI ROAD": 485000, "UPPER CHANGI ROAD": 510000 },  
                { year: 2020, "CHANGI ROAD": 495000, "UPPER CHANGI ROAD": 525000 },  
                { year: 2021, "CHANGI ROAD": 520000, "UPPER CHANGI ROAD": 550000 },  
                { year: 2022, "CHANGI ROAD": 550000, "UPPER CHANGI ROAD": 580000 },  
                { year: 2023, "CHANGI ROAD": 580000, "UPPER CHANGI ROAD": 610000 }  
            ];  

            function createChart() {  
                d3.select("#chart").selectAll("*").remove();  

                const container = document.getElementById('chart');  
                const width = container.clientWidth;  
                const height = Math.min(600, width * 0.6);  
                const margin = { top: 40, right: 80, bottom: 40, left: 50 };  

                const svg = d3.select("#chart").append("svg")  
                    .attr("width", width)  
                    .attr("height", height);  

                const xScale = d3.scaleBand()  
                    .domain(data.map(d => d.year))  
                    .range([margin.left, width - margin.right])  
                    .padding(0.2);  

                const yScale = d3.scaleLinear()  
                    .domain([0, d3.max(data, d => Math.max(d['CHANGI ROAD'], d['UPPER CHANGI ROAD']))])  
                    .range([height - margin.bottom, margin.top]);  

                svg.append("g")  
                    .attr("transform", `translate(0,${height - margin.bottom})`)  
                    .call(d3.axisBottom(xScale).tickFormat(d3.format("d")));  

                svg.append("g")  
                    .attr("transform", `translate(${margin.left},0)`)  
                    .call(d3.axisLeft(yScale).ticks(8, "s"));  

                const barGroup = svg.append("g");  
                const barWidth = xScale.bandwidth() / 2;  

                ['CHANGI ROAD', 'UPPER CHANGI ROAD'].forEach((location, i) => {  
                    barGroup.selectAll(`.${location.replace(/ /g, '')}`)  
                        .data(data)  
                        .enter()  
                        .append("rect")  
                        .attr("class", location.replace(/ /g, ''))  
                        .attr("x", d => xScale(d.year) + i * barWidth)  
                        .attr("y", d => yScale(0)) // Starts at 0 height for animation  
                        .attr("width", barWidth)  
                        .attr("height", 0) // Initial height is 0  
                        .attr("fill", i === 0 ? "#3b82f6" : "#ef4444")  
                        .transition()  
                        .duration(1000)  
                        .attr("y", d => yScale(d[location]))  
                        .attr("height", d => height - margin.bottom - yScale(d[location]));  

                    // Add interactivity (tooltip)  
                    barGroup.selectAll(`.${location.replace(/ /g, '')}-overlay`)  
                        .data(data)  
                        .enter()  
                        .append("rect")  
                        .attr("x", d => xScale(d.year) + i * barWidth)  
                        .attr("y", d => yScale(d[location]))  
                        .attr("width", barWidth)  
                        .attr("height", d => height - margin.bottom - yScale(d[location]))  
                        .attr("fill", "transparent") // Transparent overlay  
                        .on("mouseover", function(event, d) {  
                            const tooltip = d3.select("#tooltip");  
                            tooltip.style("display", "block")  
                                .style("left", `${event.pageX}px`) // 左上角与鼠标箭头重合  
                                .style("top", `${event.pageY}px`)  
                                .html(`  
                                    <div class="text-sm">${location}</div>  
                                    <div class="font-bold text-lg">${formatCurrency.format(d[location])}</div>  
                                    <div class="text-xs text-gray-300">${d.year}</div>  
                                `);  
                        })  
                        .on("mouseout", function() {  
                            d3.select("#tooltip").style("display", "none");  
                        });  
                });  
            }  

            createChart();  

            // Re-render chart on window resize  
            window.addEventListener("resize", createChart);  
        </script>  
    </body>  
    </html>  
